<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>GestiÃ³n de Talleres</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="container mt-4">

<h1 class="text-center mb-4">ğŸ“ GestiÃ³n de Talleres</h1>

<ul class="nav nav-tabs" id="myTab" role="tablist">
  <li class="nav-item" role="presentation">
    <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#estudiante">
      Estudiantes
    </button>
  </li>
  <li class="nav-item" role="presentation">
    <button class="nav-link" data-bs-toggle="tab" data-bs-target="#admin">
      Administrador
    </button>
  </li>
</ul>

<div class="tab-content mt-3">

<!-- ================= ESTUDIANTE ================= -->
<div class="tab-pane fade show active" id="estudiante">
  <h3>ğŸ“š Talleres disponibles</h3>

  <table class="table table-bordered table-hover">
    <thead class="table-dark">
      <tr>
        <th>Nombre</th>
        <th>Fecha</th>
        <th>Hora</th>
        <th>Lugar</th>
        <th>Tipo de actividad</th>
      </tr>
    </thead>
    <tbody id="tablaTalleres"></tbody>
  </table>

  <h4 class="mt-4">ğŸ“ Registrarse a un taller</h4>
  <input class="form-control mb-2" id="nombreEst" placeholder="Nombre del estudiante">
  <input class="form-control mb-2" id="correoEst" placeholder="Correo">
  <input class="form-control mb-2" id="tallerIdReg" placeholder="ID del taller">
  <button class="btn btn-success" onclick="registrarEstudiante()">
    Registrar
  </button>
</div>

<!-- ================= ADMIN ================= -->
<div class="tab-pane fade" id="admin">
  <h3>âš™ï¸ Panel Administrador</h3>

  <h5 class="mt-3">Crear / Modificar Taller</h5>
  <input class="form-control mb-2" id="tallerId" placeholder="ID (solo para modificar)">
  <input class="form-control mb-2" id="nombre" placeholder="Nombre del taller">
  <input class="form-control mb-2" id="fecha" type="date">
  <input class="form-control mb-2" id="hora" type="time">
  <input class="form-control mb-2" id="lugar" placeholder="Lugar">
  <input class="form-control mb-2" id="categoria" placeholder="Tipo de actividad">

  <button class="btn btn-primary" onclick="crearTaller()">Crear</button>
  <button class="btn btn-warning" onclick="modificarTaller()">Modificar</button>

  <h5 class="mt-4">âŒ Cancelar Taller</h5>
  <input class="form-control mb-2" id="eliminarId" placeholder="ID del taller">
  <button class="btn btn-danger" onclick="eliminarTaller()">Eliminar</button>
</div>

</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
const API = 'http://127.0.0.1:5000';

function cargarTalleres() {
  fetch(API + '/workshops')
    .then(r => r.json())
    .then(data => {
      const tabla = document.getElementById('tablaTalleres');
      tabla.innerHTML = '';
      data.forEach(t => {
        tabla.innerHTML += `
          <tr>
            <td>${t.nombre}</td>
            <td>${t.fecha || ''}</td>
            <td>${t.hora || ''}</td>
            <td>${t.lugar || ''}</td>
            <td>${t.categoria || ''}</td>
          </tr>`;
      });
    });
}

function registrarEstudiante() {
  fetch(`${API}/workshops/${tallerIdReg.value}/register`, {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({
      nombre_estudiante: nombreEst.value,
      correo: correoEst.value
    })
  }).then(() => alert('Estudiante registrado correctamente'));
}

function crearTaller() {
  fetch(API + '/workshops', {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({
      nombre: nombre.value,
      fecha: fecha.value,
      hora: hora.value,
      lugar: lugar.value,
      categoria: categoria.value
    })
  }).then(() => {
    cargarTalleres();
    alert('Taller creado');
  });
}

function modificarTaller() {
  fetch(`${API}/workshops/${tallerId.value}`, {
    method: 'PUT',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({
      nombre: nombre.value,
      fecha: fecha.value,
      hora: hora.value,
      lugar: lugar.value,
      categoria: categoria.value
    })
  }).then(() => {
    cargarTalleres();
    alert('Taller modificado');
  });
}

function eliminarTaller() {
  fetch(`${API}/workshops/${eliminarId.value}`, {
    method: 'DELETE'
  }).then(() => {
    cargarTalleres();
    alert('Taller eliminado');
  });
}

cargarTalleres();
</script>

</body>
</html>

